# Функциональная задача: Импорт музыкальной библиотеки (v0.1)

> ⚠️ Эта спецификация описывает **что делает система**, но не **как** она это делает.  
> Реализация (язык, БД, библиотеки, архитектура) — выносится за рамки ФЗ.

---

## Контекст и цели

### Основная цель
Создать приложение для импорта музыкальной коллекции в базу данных.

### Образовательная цель
- Освоить **функциональное программирование** через практику.
- Использовать **F#** как основной язык реализации.
- Осознанно сравнивать функциональный подход (F#) с императивно-объектным (PHP, в котором есть опыт).
- Научиться проектировать и реализовывать:
    - чистые функции,
    - неизменяемые структуры данных,
    - композицию поведения без наследования,
    - обработку ошибок без исключений (через `Option`, `Result` и т.п.).

### Учёт опыта
- Разработчик имеет глубокий опыт в PHP (Laravel, Symfony), включая:
    - архитектуру на основе DTO/Services/Actions,
    - API-first подход,
    - тестирование и поддержку чистоты кода.
- Это позволяет:
    - фокусироваться на **различиях парадигм**, а не на базовых концепциях разработки,
    - сознательно выбирать функциональные аналоги знакомых паттернов (например, *pipeline* вместо *цепочки вызовов методов*),
    - избегать «перевода PHP на F#» — искать *идиоматичные* решения.

---

## 1. Входные данные
- Одна локальная директория, задаваемая при запуске.
- Рекурсивный обход всех вложенных подкаталогов.

## 2. Обнаружение файлов
**СДЕЛАНО** - Найти **все** аудиофайлы, независимо от расширения.
**СДЕЛАНО** - Определить формат файла по его содержимому (сигнатура/заголовок), а не по имени.  
## 3. Обработка файла
**СДЕЛАНО** - Для каждого корректного аудиофайла извлечь метаданные (точный набор — уточняется позже).
- Если файл:
    - повреждён,
    - не содержит обязательных метаданных (уточняется),
    - не поддерживается —  
      → **пропустить его**, но зафиксировать факт и причину пропуска.

## 4. Сохранение в БД
**СДЕЛАНО** - Записать данные о треке в базу данных.
- При повторном запуске на той же директории:
    - не создавать дубликатов,
    - обновлять записи, если метаданные изменились,
    - удалять записи, если соответствующий файл больше не существует.

## 5. Логирование и отчётность
- Вывод событий в консоль: начало и завершение импорта, пропущенные файлы, итоговый отчёт.
- При завершении отображается сводка:
  - общее число найденных файлов,
  - число успешно сохранённых,
  - число пропущенных (с разбивкой по причинам: «битый», «нет метаданных», «неподдерживаемый формат»).
- Уровни: `Info` (ход выполнения), `Warn` (пропуски), `Error` (критические ошибки).
- Цветной вывод в терминале; автоматически отключается при перенаправлении (`|`, `>`).

## 6. Режимы запуска
Приложение должно поддерживать три способа активации:
- **CLI**: однократный запуск через командную строку.
- **Демон**: фоновый режим с периодической проверкой директории.
- **Триггер**: запуск по внешнему сигналу (например, HTTP-запрос, изменение файла-флага).

## 7. Гарантии поведения
- **Идемпотентность**: повторный запуск → идентичное состояние БД.
- **Отказоустойчивость**: ошибка при обработке одного файла → продолжение работы с остальными.
- **Прозрачность**: по завершении выводится отчёт, содержащий:
    - общее число найденных файлов,
    - число успешно обработанных,
    - число пропущенных (с разбивкой по категориям: «битый», «нет метаданных», «неподдерживаемый формат» и т.п.).


---